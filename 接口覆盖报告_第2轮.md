# 接口覆盖报告（第2轮）

- 时间：2026-02-20
- 范围：`frontend/src/api/**/*.js` 与 `backend/src/main/java/com/nh/smart/controller/**/*.java` 路径映射比对
- 结果：前端 API 路径 `96` 条，后端可匹配路径 `183` 条，未匹配 `0` 条

## 本轮新增兼容接口
- `AuthController`：补齐 query 兼容
  - `/saas/auth/changePhone?phone=...`
  - `/saas/auth/register?phone=...`
  - `/saas/auth/msglogin?phone=...`
- `V2CompatActionController`
  - `/abt/abtComKjActionRecord/getNowDayCount`
- 新增控制器
  - `V2CompatUserCardController`
  - `V2CompatHxController`
  - `V2CompatActivityController`
  - `V2CompatYqhSignupController`
  - `V2CompatCouponController`
  - `V2CompatSaasMiscController`

## 说明
- 本轮目标是“接口层可联调”，因此部分接口返回占位/空集合结构。
- 进入真实业务联调（尤其客户、消息、提醒、提现、卡券）前，需要本机安装 MySQL 并导入完整库。

## 第3轮进展（核心接口从占位升级为真实查询）
- `V2CompatActionController` 的以下接口已接入数据库查询（非占位返回）：
  - `/abt/abtComKjActionRecord/getCommunicationKH`
  - `/abt/abtComKjActionRecord/getRecentlyKH`
  - `/abt/abtComKjActionRecord/getStandardKH`
  - `/abt/abtComKjActionRecord/getColleague`
- 数据来源：`smart_com_kj_custom_empship` 联表 `smart_com_kj_custom_basemsg` / `smart_com_muser` / `smart_com_empno`
- 新增 DAO/Mapper 方法：`SmartKjCustomEmpshipDao.selectCustomPage`

### 提醒
以上 4 个接口要看真实结果，必须安装 MySQL 并导入完整库；未装库时接口会回退到空列表结构。

## 第4轮进展（继续核心链路）
- `V2CompatActionController`：
  - `/abt/abtComKjActionRecord/getFollowList`：已从占位改为 DB 查询并按日期分组返回
  - `/abt/abtComKjActionRecord/insertFollow`：已实现写入跟进记录
  - `/abt/abtComKjActionRecord/deleteFollow`：已实现按 id 删除跟进记录
  - `/abt/abtComKjActionRecord/getInteractiveList`：已从占位改为 DB 查询并按日期分组返回
- 新增/扩展 DAO 与 SQL：
  - `SmartComWxmsgDao.selectFollowList/deleteFollowById`
  - `SmartComKjActionRecordDao.selectInteractiveList`

### 备注
- 当前你可继续不安装 MySQL，先推进代码开发；
- 当你准备看真实列表数据时，再安装 MySQL 并导入完整库。

## 第5轮进展（分析/时间行为接口补齐结构化返回）
- `V2CompatActionController`：
  - `/abt/abtComKjActionRecord/getAIAnalysis`：返回结构化图表数据（`activeList/demandList/interactive/interest`）
  - `/abt/abtComKjActionRecord/selectTimeKHByEmpno`：返回按日期分组的“时间访客”列表（含前端依赖字段）
  - `/abt/abtComKjActionRecord/selectKHByOtype`：按 `btagcode` 过滤返回行为列表
  - `/abt/abtComKjActionRecord/getRecordAnalyze`：返回分析总览（`numList/activeList/khInteractive`）
  - `/abt/abtComKjActionRecord/getRecordKH`：返回“新增客户数”趋势（`hkDaynum`）
  - `/abt/abtComKjActionRecord/getRecordRD`：返回“阅读数”趋势（`rdDaynum`）
  - `/abt/abtComKjActionRecord/getYSLD`：返回营销漏斗分层数据
- 说明：
  - 本轮按照你的要求“不看真实数据”，先确保前端页面可渲染、可翻页、结构稳定；
  - 以上接口当前为“结构化模拟数据”，后续可按优先级逐个替换为真实 SQL 查询。

## 编译验证说明
- 已尝试本地编译后端：
  - 需先执行：`source /Users/demo/Documents/tools/use_dev_env.sh`
  - Maven 需使用本地仓库参数：`-Dmaven.repo.local='/Users/demo/Documents/New project/.m2/repository'`
- 当前受限于网络 DNS（无法访问 `repo.maven.apache.org`），依赖无法下载，暂时无法完成完整 `mvn compile` 验证。

## 第6轮进展（消息/提醒链路结构修正）
- 修正会导致前端运行时报错的接口返回结构：
  - `GET /abt/abtComKjComplain/complainlist`：由分页对象改为数组，适配意见反馈页面读取方式。
  - `GET /cpk/abtComYxhdCouponlist/grantCoupon`：返回空数组，避免首页 `length` 取值报错。
  - `POST /core/abtComUserCard/getTXRecord`：补充 `blankmessage.balance/bankname` 与提现记录示例行。
  - `POST /core/abtComUserCard/getTXRecords`：补充分页列表结构，支持“查看更多”滚动加载。
- 补充提醒模块可渲染数据结构：
  - `POST /core/abtComAlertmsg/selectByPage`：支持按类型/姓名过滤 + 分页返回；
  - `POST /core/abtComAlertmsg/checkDetails`：补齐 `dayNumber/riskconList/classlist`；
  - `GET /core/abtComAlertmsg/statistics`：补齐首页提醒角标结构（`num/data`）。
- 说明：
  - 本轮仍是“可联调结构数据”，用于保证前端页面不报错并可完整走通；
  - 后续可按你确定的优先级，将以上接口逐步替换为真实 SQL 实现。
