# 公众号上线配置项清单（功能优先版）

- 日期：2026-02-21
- 目标：先满足可上线运行，不做架构优化

## 1. 后端必须配置
文件：`/Users/demo/Documents/New project/smartForLianjie/backend/src/main/resources/application.yml`

- `spring.datasource.url`
- `spring.datasource.username`
- `spring.datasource.password`
- `server.port`（避免端口冲突）
- `spring.redis.host/port/password`（若启用 Redis）
- `mybatis-plus.global-config.db-config.id-type`（保持与现库一致）

## 2. 微信/公众号必须配置
来源接口：`GET /auth/getWxInfo`

最少需要：
- `appid`
- `scope`
- `ossurl`

可用环境变量兜底（功能优先）：
- `WX_APPID`
- `OSS_URL`
- `MS_OSS_URL`
- `COM_NAME`

关联代码位置：
- `/Users/demo/Documents/New project/smartForLianjie/frontend/src/router/index.js`
- `/Users/demo/Documents/New project/smartForLianjie/backend/src/main/java/com/nh/smart/controller/security/base/AuthController.java`

## 3. 前端域名与回调配置
文件：`/Users/demo/Documents/New project/smartForLianjie/frontend/src/config/index.js`

- `redirect_uri`（必须是公众号授权回调可访问域名）
- `baseUrl`（后端 API 域名）
- `pcossurl`（活动详情等静态资源）

## 4. 数据库最小补齐
- 先导入：`/Users/demo/Documents/New project/smart.sql`
- 再导入：`/Users/demo/Documents/New project/smart_minimal_patch.sql`

## 5. 运行前快速核对（5项）
1. `/auth/getWxInfo` 返回 `appid` 非空（生产必须）
2. `/auth/getUerInfo` 返回 `menulist/banner/bar`
3. `/abt/abtComKjActionRecord/getNowDayCount` 可访问
4. `/smartComKjLibw/selectPage` 可返回分页
5. `/abt/abtComKjActionRecord/insertKjChat` + `/abt/abtComKjActionRecord/getLS` 可走通

## 6. 冒烟脚本（自动化）
- 脚本：`/Users/demo/Documents/New project/smoke_api.sh`
- 执行：
  - `bash /Users/demo/Documents/New project/smoke_api.sh`
  - 或指定地址：`bash /Users/demo/Documents/New project/smoke_api.sh http://127.0.0.1:8080`
- 输出：`PASS/FAIL` 汇总，任一 FAIL 会返回非 0 退出码。

## 7. 你当前可直接使用的兜底能力
- 登录初始化、素材、咨询、消息中心均已有兼容兜底
- 目标是“不中断流程、可联调上线”
